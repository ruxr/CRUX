# Description:	ISC Berkeley Internet Name Domain Service
# URL:		https://www.isc.org/bind
# Maintainer:	Roman Oreshnikov, r dot oreshnikov at gmail dot com
# Depends on:	libcap libuv openssl readline zlib
# Required user: named 53
# Build also:	bindutils
buildalso() {
	mkdir -p bindutils/usr/{bin,lib,share/man/man1}
	mv $name/usr/bin/{dig,host,nsupdate} bindutils/usr/bin
	mv $name/usr/share/man/man1/{dig,host,nsupdate}.* \
		bindutils/usr/share/man/man1
	mv $name/usr/lib/* bindutils/usr/lib
	mv bindutils/usr/lib/libisccc* $name/usr/lib
}

name=bind
version=9.18.7
release=2
source=(https://downloads.isc.org/isc/bind9/$version/$name-$version.tar.xz
	named.root localhost named named.conf 127.in-addr.arpa)

build() {
	cd $name-$version

	./configure \
		--prefix=/usr \
		--sysconfdir=/etc/named \
		--localstatedir=/var \
		--enable-threads \
		--enable-largefile \
		--with-libxml2=no \
		--with-gssapi=no \
                --with-json-c=no \
                --with-python=no \
		--disable-geoip \
		--disable-doh

	make DESTDIR=$PKG install

	install -dm 770 -g named $PKG/var/named
	install -Dm 640 -g named $SRC/named.conf $PKG/etc/named/named.conf
	install -Dm 640 -g named /dev/null $PKG/etc/named/rndc.key
	install -m 640 -g named $SRC/{127.in-addr.arpa,localhost,named.root} \
		$PKG/var/named/
	install -Dm 755 $SRC/named $PKG/etc/rc.d/named

	for f in arpaname delv "dnssec-*" mdig nsec3hash nslookup; do
		rm $PKG/usr/bin/$f $PKG/usr/share/man/man1/$f.1
	done
	for f in ddns-confgen tsig-keygen; do
		rm -f $PKG/usr/sbin/$f $PKG/usr/share/man/man8/$f.8
	done
	rm -r $PKG/usr/{include,/lib/bind} $PKG/usr/share/man/man8/filter-a*
	find $PKG/usr/lib -name "*.la" -delete
}
