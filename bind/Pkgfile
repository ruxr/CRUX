# Description:	ISC Berkeley Internet Name Domain Service
# URL:		https://www.isc.org/bind
# Maintainer:	Roman Oreshnikov, r dot oreshnikov at gmail dot com
# Depends on:	json-c libcap libuv openssl readline zlib
# Build also:	bindutils
buildalso() {
	rm -r $name/usr/{include,lib} $name/usr/share/man/man8/filter-aaaa.*
	mkdir -p bindutils/usr/{bin,share/man/man1}
	mv $name/usr/bin/{dig,host,nsupdate} bindutils/usr/bin
	mv $name/usr/share/man/man1/{dig,host,nsupdate}.* \
		bindutils/usr/share/man/man1
}

name=bind
version=9.16.21
release=1
source=(https://downloads.isc.org/isc/bind9/$version/$name-$version.tar.xz
	named.root localhost named named.conf 127.in-addr.arpa)

build() {
	cd $name-$version

	./configure \
		--prefix=/usr \
		--sysconfdir=/etc/named \
		--localstatedir=/var \
		--disable-linux-caps \
		--enable-threads \
		--enable-largefile \
		--with-libxml2=no \
		--with-gssapi=no \
		--without-python

	make && make DESTDIR=$PKG install

	install -dm 770 -g named $PKG/var/named $PKG/var/run/named
	install -Dm 640 -g named $SRC/named.conf $PKG/etc/named/named.conf
	install -Dm 640 -g named /dev/null $PKG/etc/named/rndc.key
	install -m 640 -g named $SRC/{127.in-addr.arpa,localhost,named.root} \
		$PKG/var/named/
	install -Dm 755 $SRC/named $PKG/etc/rc.d/named
	for f in arpaname nslookup; do
		rm $PKG/usr/bin/$f $PKG/usr/share/man/man1/$f.1
	done
	for f in ddns-confgen "dnssec-*" nsec3hash tsig-keygen; do
		rm -f $PKG/usr/sbin/$f $PKG/usr/share/man/man8/$f.8
	done
}
